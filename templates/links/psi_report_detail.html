{% extends 'base.html' %}

{% block title %}PSI Report Details{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>PSI Report Details</h1>
    <a href="{% url 'psi_reports_list' report.link.id %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Back to Reports
    </a>
</div>

<ul class="nav nav-tabs mb-4" id="reportTabs" role="tablist">
    <li class="nav-item" role="presentation">
        <button class="nav-link active" id="mobile-tab" data-bs-toggle="tab" data-bs-target="#mobile" type="button" role="tab">
            <i class="bi bi-phone"></i> Mobile Report
        </button>
    </li>
    <li class="nav-item" role="presentation">
        <button class="nav-link" id="desktop-tab" data-bs-toggle="tab" data-bs-target="#desktop" type="button" role="tab">
            <i class="bi bi-display"></i> Desktop Report
        </button>
    </li>
</ul>

<div class="tab-content" id="reportTabsContent">
    <!-- Mobile Report Tab -->
    <div class="tab-pane fade show active" id="mobile" role="tabpanel">
        {% with report_data=report.mobile_report.lighthouseResult %}
            {% include 'links/partials/psi_report_content.html' with report_data=report_data %}
        {% endwith %}
    </div>
    
    <!-- Desktop Report Tab -->
    <div class="tab-pane fade" id="desktop" role="tabpanel">
        {% with report_data=report.desktop_report.lighthouseResult %}
            {% include 'links/partials/psi_report_content.html' with report_data=report_data %}
        {% endwith %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileData = {
        performance: {{ report.mobile_report.lighthouseResult.categories.performance.score }},
        accessibility: {{ report.mobile_report.lighthouseResult.categories.accessibility.score }},
        'best-practices': {{ report.mobile_report.lighthouseResult.categories.bestPractices.score }},
        seo: {{ report.mobile_report.lighthouseResult.categories.seo.score }}
    };

    const desktopData = {
        performance: {{ report.desktop_report.lighthouseResult.categories.performance.score }},
        accessibility: {{ report.desktop_report.lighthouseResult.categories.accessibility.score }},
        'best-practices': {{ report.desktop_report.lighthouseResult.categories.bestPractices.score }},
        seo: {{ report.desktop_report.lighthouseResult.categories.seo.score }}
    };

    let chart = null;

    function createChart(data) {
        const ctx = document.getElementById('categoryScoresChart').getContext('2d');
        if (chart) {
            chart.destroy();
        }
        chart = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: Object.keys(data).map(key => key.charAt(0).toUpperCase() + key.slice(1)),
                datasets: [{
                    label: 'Category Scores',
                    data: Object.values(data),
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    pointBackgroundColor: 'rgba(54, 162, 235, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(54, 162, 235, 1)'
                }]
            },
            options: {
                scales: {
                    r: {
                        beginAtZero: true,
                        max: 1
                    }
                }
            }
        });
    }

    // Initialize with mobile data
    createChart(mobileData);

    // Update chart when switching tabs
    document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(button => {
        button.addEventListener('shown.bs.tab', function(e) {
            const target = e.target.getAttribute('data-bs-target');
            if (target === '#mobile') {
                createChart(mobileData);
            } else if (target === '#desktop') {
                createChart(desktopData);
            }
        });
    });
});
</script>
{% endblock %} 